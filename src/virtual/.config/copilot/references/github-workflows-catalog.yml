# GitHub Workflows Reference - Official Workflows Catalog
# This file documents all official GitHub Actions workflows in the repository.
# For reusable components and development guidance, see github-workflows-development.yml

metadata: &metadata
  version: "1.0.0"
  category: reference
  keywords: [GitHub Actions, CI/CD, workflows, pipeline, testing, deployment]

<<: *metadata

overview: |
  GitHub Actions CI/CD pipeline for semantic-kernel-app using modular reusable workflows.
  Main orchestrator is pipeline.yml which calls reusable jobs from jobs/ directory.
  All workflows follow enterprise standards with caching, artifacts, and comprehensive testing.

official_workflows:
  pipeline:
    file: ".github/workflows/pipeline.yml"
    description: "Main CI/CD orchestrator - calls all reusable jobs in sequence"
    trigger:
      - "push: main"
      - "pull_request: main"
    stages:
      - build: "Calls jobs/build.yml"
      - test: "Calls jobs/test.yml"
      - docker: "Calls jobs/docker.yml"
      - deploy: "Calls jobs/deploy.yml (on main only)"
    features:
      - "Parallel execution where possible"
      - "Artifact passing between jobs"
      - "Environment-specific deployment"
      - "Comprehensive status reporting"

  ci_full:
    file: ".github/workflows/ci-full.yml"
    description: "Complete CI validation for pull requests"
    trigger:
      - "pull_request: main"
    stages:
      - "Code quality checks (linting, formatting)"
      - "Build validation (.NET, frontend, Python)"
      - "Unit tests with coverage"
      - "Integration tests"
      - "E2E tests with Playwright"
    features:
      - "Fail-fast on critical errors"
      - "Test result artifacts"
      - "Coverage reports"

  pr_validation:
    file: ".github/workflows/pr-validation.yml"
    description: "Fast validation for PRs - subset of ci-full"
    trigger:
      - "pull_request: **"
    checks:
      - "YAML linting"
      - "C# build"
      - "TypeScript build"
      - "Python syntax"
      - "Docker Compose validation"
    performance: "~2-3 minutes on ubuntu-latest"

  precommit:
    file: ".github/workflows/precommit.yml"
    description: "Pre-commit hook validation via GitHub Actions"
    trigger:
      - "push: **"
      - "pull_request: **"
    hooks:
      - "trailing-whitespace"
      - "end-of-file-fixer"
      - "check-yaml"
      - "check-added-large-files"
      - "dotnet-format"
      - "black (Python)"
      - "isort (Python)"
      - "ruff (Python)"
      - "sqlfluff (SQL)"
      - "eslint (TypeScript)"
      - "prettier (TypeScript)"

  precommit_autoupdate:
    file: ".github/workflows/precommit-autoupdate.yml"
    description: "Auto-update pre-commit hooks weekly"
    trigger:
      - "schedule: weekly (Monday 00:00 UTC)"
      - "workflow_dispatch: manual"
    features:
      - "Creates PR with updated .pre-commit-config.yaml"
      - "Auto-merge if tests pass"

  test_docker:
    file: ".github/workflows/test-docker.yml"
    description: "Docker Compose integration testing"
    trigger:
      - "push: main"
      - "pull_request: main"
      - "workflow_dispatch: manual"
    stages:
      - "Build all service images"
      - "Start docker-compose stack"
      - "Health check validation"
      - "Integration test execution"
      - "Service log collection"
    features:
      - "Uses docker-compose.yml"
      - "Validates all 11 services"
      - "Collects logs on failure"

  yamllint:
    file: ".github/workflows/yamllint.yml"
    description: "YAML syntax and style validation"
    trigger:
      - "push: **"
      - "pull_request: **"
    targets:
      - ".github/workflows/*.yml"
      - ".config/**/*.yml"
      - "semantic/**/*.yml"
      - "docker-compose*.yml"
    rules: "Follows yamllint strict configuration"

  copilot_setup_steps:
    file: ".github/workflows/copilot-setup-steps.yml"
    description: "GitHub Copilot Coding Agent environment setup"
    trigger:
      - "workflow_dispatch: manual"
    purpose: "Configure ephemeral environment for Copilot agent with dependencies and optional services"
    features:
      - ".NET 10 SDK installation"
      - "Python 3.14 with tools/requirements.txt"
      - "Node.js 20 with frontend/test dependencies"
      - "Service containers (optional): PostgreSQL, Qdrant, Redis"
      - "Comprehensive caching (NuGet, pip, npm)"
      - "Environment verification and summary"
      - "GPU support via CUDA 13.0 (local development)"
    documentation: "See .config/copilot/workflows/copilot-agent.yml"
    environment_config: ".config/environment.yml"

performance:
  build_times:
    - "pr-validation: ~2-3 minutes (fast feedback)"
    - "ci-full: ~8-12 minutes (comprehensive)"
    - "pipeline (full): ~15-20 minutes (with deployment)"
    - "test-docker: ~10-15 minutes (Docker Compose stack)"

  runner_matrix:
    - "ubuntu-latest: Default (2-core, 7GB RAM, 14GB SSD)"
    - "ubuntu-4-core: Larger runner (4-core, 16GB RAM, 14GB SSD) - 30-40% faster builds"

artifacts:
  build_artifacts:
    retention: "7 days"
    contents:
      - "backend/bin/Release/net10.0/"
      - "business/bin/Release/net10.0/"
      - "engine/bin/Release/net10.0/"
      - "gateway/bin/Release/net10.0/"
      - "frontend/dist/"

  test_results:
    retention: "30 days"
    contents:
      - "test-results/junit.xml"
      - "test-results/coverage/"
      - "playwright-report/"

  docker_images:
    retention: "90 days (in registry)"
    tags:
      - "sha-<commit>: Immutable reference"
      - "branch-<name>: Latest for branch"
      - "latest: Production release"

usage_examples:
  trigger_manual_workflow: |
    # Via GitHub UI: Actions → workflow → Run workflow
    # Via gh CLI:
    gh workflow run pipeline.yml --ref main
    gh workflow run copilot-setup-steps.yml --ref feature/new-agent

  trigger_with_inputs: |
    gh workflow run test.yml \
      --ref main \
      --field run-unit=true \
      --field run-integration=true \
      --field run-e2e=false

  view_workflow_status: |
    gh run list --workflow=pipeline.yml
    gh run view <run-id> --log

  download_artifacts: |
    gh run download <run-id> --name build-artifacts
    gh run download <run-id> --name test-results

agent_testing:
  copilot_agent_workflow:
    purpose: "Test Copilot agent environment with realistic CI setup"
    usage: |
      1. Trigger copilot-setup-steps.yml manually
      2. Uncomment service containers if needed (PostgreSQL, Qdrant, Redis)
      3. Agent runs in ephemeral environment with full dependencies
      4. Verify environment summary output for configuration

    customization:
      enable_services: "Uncomment services: postgres, qdrant, redis in copilot-setup-steps.yml"
      change_versions: "Update env: DOTNET_VERSION, PYTHON_VERSION, NODE_VERSION"
      add_steps: "Insert additional setup steps after dependency installation"

related_documentation:
  - ".config/copilot/workflows/github-workflows-development.yml: Reusable components and development"
  - ".config/copilot/workflows/copilot-agent.yml: Copilot agent environment details"
  - ".config/copilot/patterns/documentation.yml: Documentation standards"
  - "infrastructure/database/README.md: Database migration workflows"
  - "dockerfiles/README.md: Docker image build documentation"
