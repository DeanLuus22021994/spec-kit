# Indentation Validation Rules
# Enforces 2-space indentation, no tabs, consistent alignment

- ruleID: yaml-no-tabs-indentation
  description: |
    YAML files must use spaces for indentation, never tabs.
    Tabs cause parsing errors and inconsistent rendering.
  labels:
    - "konveyor.io/source=yaml"
    - "konveyor.io/target=yaml-best-practices"
    - "category=mandatory"
  when:
    builtin.filecontent:
      filePattern: ".*\\.(yml|yaml)$"
      pattern: "^\t"
  customVariables:
    - pattern: "^(\t+)"
      name: tabCharacters
  message: |
    Tab character detected for indentation.

    YAML specification requires spaces, not tabs.

    Convert all tabs to 2 spaces using:
    - Editor: "Convert Indentation to Spaces"
    - Command: sed 's/\t/  /g' file.yml
  effort: 1
  category: mandatory
  links:
    - url: "file:///.config/copilot/yaml-best-practices.yml#indentation"
      title: "YAML Indentation Rules - No Tabs"

- ruleID: yaml-two-space-indentation
  description: |
    Use 2 spaces per indentation level consistently throughout the file.
  labels:
    - "konveyor.io/source=yaml"
    - "konveyor.io/target=yaml-best-practices"
    - "category=mandatory"
  when:
    or:
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "^   [a-zA-Z]"
          # 3 spaces
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "^    [a-zA-Z]"
          # 4 spaces at first level
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "^     [a-zA-Z]"
          # 5 spaces
  message: |
    Inconsistent indentation detected.

    Standard: 2 spaces per level
    - Level 0: No indentation
    - Level 1: 2 spaces
    - Level 2: 4 spaces
    - Level 3: 6 spaces

    Configure editor:
    - Tab size: 2
    - Insert spaces: true
    - Detect indentation: false
  effort: 2
  category: mandatory
  links:
    - url: "file:///.config/copilot/yaml-best-practices.yml#indentation"
      title: "YAML Two-Space Indentation Standard"

- ruleID: yaml-list-alignment
  description: |
    List items (starting with -) should align with parent key indentation.
  labels:
    - "konveyor.io/source=yaml"
    - "konveyor.io/target=yaml-best-practices"
    - "category=mandatory"
  when:
    builtin.filecontent:
      filePattern: ".*\\.(yml|yaml)$"
      pattern: "^\\s+- "
  message: |
    List item detected - verify alignment.

    Correct pattern:
    parent_key:
      - item1    # 2 spaces, then -
      - item2

    Incorrect:
    parent_key:
    - item1      # No indentation
     - item2     # Odd spacing
  effort: 1
  category: mandatory
  links:
    - url: "file:///.config/copilot/yaml-best-practices.yml#indentation"
      title: "YAML List Item Alignment"

- ruleID: yaml-nested-structure-alignment
  description: |
    Nested structures must maintain consistent indentation at each level.
  labels:
    - "konveyor.io/source=yaml"
    - "konveyor.io/target=yaml-best-practices"
    - "category=mandatory"
  when:
    builtin.filecontent:
      filePattern: ".*\\.(yml|yaml)$"
      pattern: "^\\s+[a-zA-Z_][a-zA-Z0-9_]*:\\s*$"
  message: |
    Nested key found - verify indentation consistency.

    Each nesting level should increment by exactly 2 spaces:

    level1:
      level2:
        level3:
          level4: value

    Check that child elements are indented exactly 2 spaces from parent.
  effort: 2
  category: mandatory
  links:
    - url: "file:///.config/copilot/yaml-best-practices.yml#indentation"
      title: "YAML Nested Structure Guidelines"

- ruleID: yaml-multiline-string-indentation
  description: |
    Multiline strings (| or >) must have consistent content indentation.
  labels:
    - "konveyor.io/source=yaml"
    - "konveyor.io/target=yaml-best-practices"
    - "category=mandatory"
  when:
    or:
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "^\\s+[a-zA-Z_][a-zA-Z0-9_]*:\\s*\\|"
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "^\\s+[a-zA-Z_][a-zA-Z0-9_]*:\\s*>"
  message: |
    Multiline string indicator found.

    Content after | or > should be indented 2 spaces from the key:

    description: |
      This is line 1
      This is line 2
      All lines at same indentation

    Verify all content lines have consistent indentation.
  effort: 2
  category: mandatory
  links:
    - url: "file:///.config/copilot/yaml-best-practices.yml#multiline_strings"
      title: "YAML Multiline String Indentation"

- ruleID: yaml-flow-style-spacing
  description: |
    Flow style collections should use consistent spacing around braces and brackets.
  labels:
    - "konveyor.io/source=yaml"
    - "konveyor.io/target=yaml-best-practices"
    - "category=optional"
  when:
    or:
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "\\{[^ ]"
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "[^ ]\\}"
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "\\[[^ ]"
      - builtin.filecontent:
          filePattern: ".*\\.(yml|yaml)$"
          pattern: "[^ ]\\]"
  message: |
    Flow style collection found without proper spacing.

    Best practice for flow collections:
    - Mappings: {key1: value1, key2: value2}
    - Sequences: [item1, item2, item3]

    Space after opening brace/bracket
    Space before closing brace/bracket
    Space after commas
  effort: 1
  category: optional
  links:
    - url: "file:///.config/copilot/yaml-best-practices.yml#collections"
      title: "YAML Flow Style Formatting"
