{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/konveyor/kantra/schemas/profile-schema.json",
  "title": "Validation Profile Schema",
  "description": "JSON Schema for validation profile definitions",
  "type": "object",
  "additionalProperties": false,
  "required": ["metadata", "rules"],
  "definitions": {
    "severity": {
      "type": "string",
      "enum": ["mandatory", "optional", "potential", "info"]
    }
  },
  "properties": {
    "metadata": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "description", "version"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "Profile name",
          "examples": ["strict", "recommended", "minimal"]
        },
        "description": {
          "type": "string",
          "description": "Profile description"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version"
        },
        "author": {
          "type": "string",
          "description": "Author or maintainer of the profile"
        },
        "extends": {
          "type": "string",
          "description": "Parent profile to inherit from"
        }
      }
    },
    "rules": {
      "type": "object",
      "description": "Rule package configuration",
      "additionalProperties": false,
      "patternProperties": {
        "^[a-z0-9-.]+$": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "severity": {
              "oneOf": [
                { "$ref": "#/definitions/severity" },
                {
                  "type": "array",
                  "items": { "$ref": "#/definitions/severity" }
                }
              ],
              "description": "Severity filter (single or multiple)"
            },
            "all": {
              "type": "boolean",
              "description": "Include all rules from package"
            },
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable or disable this rule package"
            },
            "tags": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Filter rules by tags"
            }
          }
        }
      }
    },
    "options": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "failOnWarning": {
          "type": "boolean",
          "default": false,
          "description": "Fail validation on warnings"
        },
        "failOnInfo": {
          "type": "boolean",
          "default": false,
          "description": "Fail validation on info messages"
        },
        "maxViolations": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum allowed violations (0 = none)"
        },
        "includePaths": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns to include"
        },
        "excludePaths": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns to exclude"
        },
        "outputFormat": {
          "type": "string",
          "enum": ["json", "yaml", "text", "sarif"],
          "default": "json"
        }
      },
      "description": "Profile-specific options"
    }
  },
  "examples": [
    {
      "metadata": {
        "name": "strict",
        "description": "Zero-tolerance validation profile",
        "version": "1.0.0"
      },
      "rules": {
        "metadata": {
          "severity": "mandatory",
          "all": true
        },
        "syntax": {
          "severity": "mandatory",
          "all": true
        },
        "structure": {
          "severity": "mandatory",
          "all": true
        },
        "mta": {
          "severity": "mandatory",
          "all": true
        },
        "quality": {
          "severity": "mandatory",
          "all": true
        },
        "vscode": {
          "severity": "mandatory",
          "all": true
        }
      },
      "options": {
        "failOnWarning": true,
        "failOnInfo": true,
        "maxViolations": 0
      }
    },
    {
      "metadata": {
        "name": "recommended",
        "description": "Balanced validation profile (default)",
        "version": "1.0.0"
      },
      "rules": {
        "metadata": {
          "severity": "mandatory"
        },
        "syntax": {
          "severity": ["mandatory", "optional"]
        },
        "structure": {
          "severity": "mandatory"
        },
        "mta": {
          "severity": ["mandatory", "optional"]
        },
        "quality": {
          "severity": "mandatory"
        },
        "vscode": {
          "severity": "optional"
        }
      },
      "options": {
        "failOnWarning": false,
        "failOnInfo": false,
        "maxViolations": 10
      }
    }
  ]
}
